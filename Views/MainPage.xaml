<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.Maui;assembly=LiveChartsCore.SkiaSharpView.Maui"
             xmlns:vm="clr-namespace:IndustrialLink.ViewModels"
             x:Class="IndustrialLink.Views.MainPage"
             Title="Industrial Link - Serial Monitor">

    <Grid RowDefinitions="Auto, *, Auto"
          ColumnDefinitions="350, *"
          Padding="10"
          RowSpacing="10"
          ColumnSpacing="10">
        
        <!-- BorderLayout.North -->
        <Grid Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" ColumnDefinitions="*, Auto">
            <Label Grid.Column="0"
                   Text="Industrial Link System Check"
                   FontSize="24"
                   FontAttributes="Bold"
                   TextColor="DarkBlue"
                   VerticalOptions="Center" />
            <Grid Grid.Column="1" 
                  ColumnDefinitions="Auto, 60, Auto" 
                  VerticalOptions="Center" 
                  HorizontalOptions="End" 
                  ColumnSpacing="5">
                <Label Grid.Column="0" 
                       Text="Simulation" 
                       VerticalOptions="Center" 
                       FontSize="14" >
                    <Label.Triggers>
                        <DataTrigger TargetType="Label"
                                     Binding="{Binding IsHardwareMode}"
                                     Value="False">
                            <Setter Property="FontAttributes" Value="Bold" />
                            <Setter Property="TextColor" Value="DarkBlue" />
                        </DataTrigger>
                    </Label.Triggers>
                </Label>
                <Switch Grid.Column="1" 
                        IsToggled="{Binding IsHardwareMode}"
                        WidthRequest="50"
                        Margin="5"
                        HorizontalOptions="Center"
                        VerticalOptions="Center" />
                <Label Grid.Column="2" 
                       Text="Hardware" 
                       VerticalOptions="Center" 
                       FontSize="14">
                    <Label.Triggers>
                        <DataTrigger TargetType="Label" 
                                     Binding="{Binding IsHardwareMode}"
                                     Value="True">
                            <Setter Property="FontAttributes" Value="Bold" />
                            <Setter Property="TextColor" Value="DarkBlue" />
                        </DataTrigger>
                    </Label.Triggers>
                </Label>
            </Grid>
        </Grid>

        <!-- BorderLayout.West -->
        <Border Grid.Row="1" Grid.Column="0"
          Stroke="Gray" StrokeThickness="1"
          Padding="0">
            <Grid RowDefinitions="Auto, *">
                <Label Grid.Row="0" Text="Communication Log"
               BackgroundColor="LightGray" Padding="5" FontAttributes="Bold" />
                <CollectionView Grid.Row="1" ItemsSource="{Binding ReceivedData}">
                    <CollectionView.EmptyView>
                        <Label Text="Keine Daten..." TextColor="Gray" HorizontalOptions="Center" VerticalOptions="Center"/>
                    </CollectionView.EmptyView>
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Label Text="{Binding .}"
                           FontFamily="Courier New"
                           FontSize="12"
                           LineBreakMode="NoWrap"
                           Padding="5,2" />
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>
        </Border>
        
        <!-- BorderLayout.Center -->
        <Border Grid.Row="1" Grid.Column="1"
                Stroke="LightGray" StrokeThickness="1"
                Padding="10" >
            <lvc:CartesianChart
                Series="{Binding Series}"
                XAxes="{Binding XAxes}"
                YAxes="{Binding YAxes}">
                <lvc:CartesianChart.Title>
                    <lvc:XamlDrawnLabelVisual
                        Text="Messwertverlauf"
                        TextSize="25"
                        Padding="10"
                        Paint="DarkSlateGray" />
                </lvc:CartesianChart.Title>
            </lvc:CartesianChart>
        </Border>
        
        <!-- BorderLayout.South -->
        <Border Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                Stroke="LightGray" StrokeThickness="1"
                Padding="10" BackgroundColor="#F5F5F5">
            <Grid ColumnDefinitions="Auto, *" ColumnSpacing="10">
                <HorizontalStackLayout Grid.Column="0" Spacing="5" VerticalOptions="Center">
                    <Label Text="Status:" FontAttributes="Bold" VerticalOptions="Center"/>
                    <Label Text="{Binding StatusMessage}" TextColor="Blue" VerticalOptions="Center"/>
                </HorizontalStackLayout>

                <HorizontalStackLayout Grid.Column="1" Spacing="10" VerticalOptions="Center" HorizontalOptions="Center">
                    <Button Text="Scan"
                            Command="{Binding LoadPortsCommand}" MinimumWidthRequest="80" BackgroundColor="#6E6E6E"/>

                    <Picker Title="Port wählen"
                            ItemsSource="{Binding AvailablePorts}"
                            SelectedItem="{Binding SelectedPort}"
                            WidthRequest="120"
                            VerticalOptions="Center"
                            TextColor="Blue"/>

                    <Label Text="Max. Punkte:" VerticalOptions="Center" Margin="10,0,0,0"
                           TextColor="Blue"/>
                    <Entry Text="{Binding MaxDataPoints}"
                           Keyboard="Numeric"
                           WidthRequest="60"
                           HorizontalTextAlignment="Center"/>

                    <Button Text="Start"
                            Command="{Binding StartCommand}"
                            BackgroundColor="DarkGreen"
                            TextColor="White"
                            FontAttributes="Bold"
                            MinimumWidthRequest="80"/>

                    <Button Text="Stop"
                            Command="{Binding StopCommand}"
                            BackgroundColor="DarkRed"
                            TextColor="White"
                            MinimumWidthRequest="80"/>
                </HorizontalStackLayout>
            </Grid>
        </Border>
    </Grid>      
</ContentPage>
